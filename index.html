<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì¬ë°° ë³´ë“œ</title>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<style>
body{font-family:Arial;background:#f4f6f8;margin:0;padding:20px;}
#clock{font-size:18px;margin:0;}
.top-controls{display:flex;gap:10px;}
.top-controls button{padding:8px 14px;border:none;border-radius:8px;background:#6c8fc7;color:white;cursor:pointer;}
.board{display:flex;gap:20px;align-items:flex-start;}
.column{background:#e9eef5;padding:12px;border-radius:20px;width:300px;display:flex;flex-direction:column;}
.column-header{background:#6c8fc7;color:white;padding:10px;border-radius:16px;font-weight:bold;display:flex;justify-content:space-between;}
.card-container{margin-top:10px;display:flex;flex-direction:column;gap:12px;}
.card{background:white;padding:16px;border-radius:18px;box-shadow:0 2px 6px rgba(0,0,0,0.1);position:relative;}
.label{font-weight:bold;margin-bottom:10px;outline:none;}
.date-section{display:flex;justify-content:space-between;margin-top:6px;}
.date-block{width:48%;display:flex;flex-direction:column;}
.small{font-size:11px;color:#666;}
.big{font-size:18px;font-weight:bold;margin:2px 0;}
.date-text{font-size:13px;}
.divider-vertical{width:1px;background:rgba(0,0,0,0.15);}
.memo-divider{height:1px;background:rgba(0,0,0,0.2);margin:10px 0 6px 0;}
.memo{font-size:13px;}
.error{color:red;font-weight:bold;font-size:12px;margin-top:4px;}
.change-info{font-size:12px;margin-top:8px;color:#444;display:flex;align-items:center;gap:6px;}
.change-info.orange{color:orange;font-weight:bold;}
.change-info.red{color:red;font-weight:bold;text-decoration:underline;}
.card-menu{position:absolute;top:8px;right:10px;cursor:pointer;}
.card-options{display:none;position:absolute;top:26px;right:8px;background:white;border:1px solid #ccc;border-radius:8px;padding:6px;font-size:12px;z-index:1000;}
.card-options div{padding:6px 8px;cursor:pointer;}
.card-options div:hover{background:#f0f0f0;}
.add-card-btn{margin-top:10px;padding:10px 0;border:none;border-radius:16px;background:#d0d8e8;font-size:22px;cursor:pointer;}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.4);display:flex;justify-content:center;align-items:center;z-index:2000;}
.modal-content{background:white;padding:30px;border-radius:20px;width:600px;display:flex;flex-direction:column;gap:20px;}
.modal-fields{display:flex;gap:30px;justify-content:center;}
.modal-block{display:flex;flex-direction:column;gap:6px;align-items:center;}
.modal-block input{width:90px;padding:8px;border-radius:10px;border:1px solid #ccc;text-align:center;}
.modal-buttons{display:flex;justify-content:flex-end;gap:10px;}
.save-btn{background:#6c8fc7;color:white;padding:8px 16px;border:none;border-radius:10px;}
.cancel-btn{background:#ccc;padding:8px 16px;border:none;border-radius:10px;}
.mark-btn{background:#28a745;color:white;padding:4px 8px;border:none;border-radius:10px;font-size:11px;}
.task-card{
  background:white;
  padding:14px 20px;
  border-radius:18px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
  display:flex;
  align-items:center;
  gap:20px;
  position:relative;
}

.top-bar{
  display:flex;
  align-items:center;
  margin-bottom:20px;
}

.top-controls{
  margin-left:auto;
  display:flex;
  gap:10px;
}

</style>
</head>

<body>

<div class="top-bar">
  <h1 id="clock"></h1>
  <div class="top-controls">
    <button onclick="addColumn()">ì—´ ì¶”ê°€</button>
    <button onclick="saveData()">ì €ì¥</button>
    <button onclick="undoAction()">ì´ì „ í–‰ë™ ë³µêµ¬</button>
  </div>
</div>
<hr style="margin:-5px 0;border:1px dashed #bbb">

<h2 id="farmTitle"
    contenteditable="true"
    oninput="localStorage.setItem('farmBoardTitle', this.innerText)">
  ì¬ë°°ê¸° í˜„í™©
</h2>
<div class="board" id="board"></div>
<hr style="margin:0px 0;border:1px dashed #bbb">

<h2 id="taskTitle"
    contenteditable="true"
    oninput="localStorage.setItem('taskBoardTitle', this.innerText)">
  ì‘ì—… ë°°ë„ˆ
</h2>


<div id="taskBoard" style="display:flex;flex-direction:column;gap:12px;"></div>


<script>

// ===== ë°ì´í„° =====
let columns = JSON.parse(localStorage.getItem("farmData")) || [];
let tasks = JSON.parse(localStorage.getItem("taskData")) || [];
let historyStack = [];


// ===== íˆìŠ¤í† ë¦¬ =====
function saveHistory(){
  historyStack.push(JSON.stringify(columns));
  if(historyStack.length>50) historyStack.shift();
}

function undoAction(){
  if(historyStack.length===0){
    alert("ë˜ëŒë¦´ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }
  columns = JSON.parse(historyStack.pop());
  createUI();
}

// Ctrl+Z
document.addEventListener("keydown",(e)=>{
  if(e.ctrlKey && e.key==="z"){
    e.preventDefault();
    undoAction();
  }
});

// ===== ê³µìš© =====
import { doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

async function saveData(){
  // ë¡œì»¬Storage ì €ì¥ì€ ìœ ì§€í•´ë„ ë¨
  localStorage.setItem("farmData", JSON.stringify(columns));
  localStorage.setItem("taskData", JSON.stringify(tasks));

  try {
    await setDoc(doc(db, "farmData", "board"), {
      columns: columns,
      tasks: tasks
    });
    alert("Firestore ì €ì¥ ì™„ë£Œ âœ…");
  } catch (e) {
    console.error("Firestore ì €ì¥ ì˜¤ë¥˜:", e);
    alert("Firestore ì €ì¥ ì‹¤íŒ¨ âŒ");
  }
}



function formatDate(d){
  if(!d) return "-";
  return `${d.year}.${String(d.month).padStart(2,"0")}.${String(d.day).padStart(2,"0")}`;
}

function updateClock(){
  document.getElementById("clock").innerText=new Date().toLocaleString();
}

function validateDate(d){
  if(!d) return {valid:false,error:"ê°’ ì—†ìŒ"};
  const y=new Date().getFullYear();
  let err=[];
  if(d.year<y-1||d.year>y+1) err.push("yy ì˜¤ë¥˜");
  if(d.month<1||d.month>12) err.push("mm ì˜¤ë¥˜");
  if(d.day<1||d.day>31) err.push("dd ì˜¤ë¥˜");
  return {valid:err.length===0,error:err.join(", ")};
}

function formatDays(date){
  if(!date) return "-";
  const diff=((new Date()-new Date(date.year,date.month-1,date.day,date.hour||0))/(1000*60*60*24)).toFixed(1);
  return diff+"ì¼ì°¨";
}

// ===== ëª¨ë‹¬ =====
function createModal(html){
  const m=document.createElement("div");
  m.className="modal";
  m.innerHTML=html;

  m.onclick=(e)=>{ 
    if(e.target===m) m.remove(); 
  };

  // âœ… ESCë¡œ ë‹«ê¸°
  function escHandler(e){
    if(e.key==="Escape"){
      m.remove();
      document.removeEventListener("keydown",escHandler);
    }
  }
  document.addEventListener("keydown",escHandler);

  document.body.appendChild(m);
  return m;
}

function closeModal(btn){btn.closest(".modal").remove();}

// ===== ë‚ ì§œ ëª¨ë‹¬ =====
function dateInputs(p,d){
  return `
  <div class="modal-block">
    <label>ë…„</label>
    <input type="number" id="${p}-year" value="${d.year}" min="2000" max="2100" step="1">
  </div>
  <div class="modal-block">
    <label>ì›”</label>
    <input type="number" id="${p}-month" value="${d.month}" min="1" max="12" step="1">
  </div>
  <div class="modal-block">
    <label>ì¼</label>
    <input type="number" id="${p}-day" value="${d.day}" min="1" max="31" step="1">
  </div>
  <div class="modal-block">
    <label>ì‹œê°„</label>
    <input type="number" id="${p}-hour" value="${d.hour||0}" min="0" max="23" step="1">
  </div>`;
}

function openDateEditor(c,r){
  const crop=columns[c].crops[r];
  if(crop.showSow===undefined) crop.showSow=true;
  if(crop.showTrans===undefined) crop.showTrans=true;

  createModal(`
    <div class="modal-content">
      <div>íŒŒì¢…ì¼</div>
      <div class="modal-fields">
        <div class="modal-block">
          <label>í‘œì‹œ</label>
          <input type="checkbox" id="showSow" ${crop.showSow?"checked":""}>
        </div>
        ${dateInputs("sow",crop.sow)}
      </div>

      <div>ì •ì‹ì¼</div>
      <div class="modal-fields">
        <div class="modal-block">
          <label>í‘œì‹œ</label>
          <input type="checkbox" id="showTrans" ${crop.showTrans?"checked":""}>
        </div>
        ${dateInputs("trans",crop.trans)}
      </div>

      <div class="modal-buttons">
        <button class="cancel-btn" onclick="closeModal(this)">ì·¨ì†Œ</button>
        <button class="save-btn" onclick="saveDate(${c},${r},this)">ì €ì¥</button>
      </div>
    </div>
  `);
}

function saveDate(c,r,btn){
  saveHistory();
  const m=btn.closest(".modal");

  columns[c].crops[r].sow={
    year:+m.querySelector("#sow-year").value,
    month:+m.querySelector("#sow-month").value,
    day:+m.querySelector("#sow-day").value,
    hour:+m.querySelector("#sow-hour").value
  };

  columns[c].crops[r].trans={
    year:+m.querySelector("#trans-year").value,
    month:+m.querySelector("#trans-month").value,
    day:+m.querySelector("#trans-day").value,
    hour:+m.querySelector("#trans-hour").value
  };

  columns[c].crops[r].showSow=m.querySelector("#showSow").checked;
  columns[c].crops[r].showTrans=m.querySelector("#showTrans").checked;

  m.remove();
  createUI();
}

// ===== ë©”ëª¨ =====
function openMemoEditor(c,r){
  const crop=columns[c].crops[r];
  createModal(`
  <div class="modal-content">
    <textarea id="memoText" style="height:100px">${crop.memo||""}</textarea>
    <div class="modal-buttons">
      <button class="cancel-btn" onclick="closeModal(this)">ì·¨ì†Œ</button>
      <button class="save-btn" onclick="saveMemo(${c},${r},this)">ì €ì¥</button>
    </div>
  </div>`);
}

function saveMemo(c,r,btn){
  saveHistory();
  columns[c].crops[r].memo=btn.closest(".modal").querySelector("#memoText").value;
  btn.closest(".modal").remove();
  createUI();
}

// ===== ì–‘ì•¡ =====
function openChangeEditor(c,r){
  const crop=columns[c].crops[r];
  if(crop.showChange===undefined) crop.showChange=true;

  createModal(`
  <div class="modal-content">
    <div>ì–‘ì•¡ êµì²´ì¼</div>
    <div class="modal-fields">
      <div class="modal-block">
        <label>í‘œì‹œ</label>
        <input type="checkbox" id="showChange" ${crop.showChange?"checked":""}>
      </div>
      ${dateInputs("change",crop.lastChange)}
    </div>
    <div class="modal-buttons">
      <button class="cancel-btn" onclick="closeModal(this)">ì·¨ì†Œ</button>
      <button class="mark-btn" onclick="completeChangeNow(${c},${r},this)">êµì²´ ì™„ë£Œ</button>
      <button class="save-btn" onclick="saveChange(${c},${r},this)">ì €ì¥</button>
    </div>
  </div>`);
}

function completeChangeNow(c,r,btn){
  saveHistory();
  const now=new Date();

  columns[c].crops[r].lastChange={
    year:now.getFullYear(),
    month:now.getMonth()+1,
    day:now.getDate(),
    hour:now.getHours()
  };

  columns[c].crops[r].showChange=
    btn.closest(".modal").querySelector("#showChange").checked;

  btn.closest(".modal").remove();
  createUI();
}


function saveChange(c,r,btn){
  saveHistory();
  const m=btn.closest(".modal");

  columns[c].crops[r].lastChange={
    year:+m.querySelector("#change-year").value,
    month:+m.querySelector("#change-month").value,
    day:+m.querySelector("#change-day").value,
    hour:+m.querySelector("#change-hour").value
  };

  columns[c].crops[r].showChange=m.querySelector("#showChange").checked;

  m.remove();
  createUI();
}

// ===== UI ìƒì„± =====
function createUI(){
  const board=document.getElementById("board");
  board.innerHTML="";

  columns.forEach((col,ci)=>{

const column=document.createElement("div");
column.className="column";
column.dataset.index=ci;


    column.innerHTML=`
      <div class="column-header">
        <div contenteditable oninput="columns[${ci}].header=this.innerText">${col.header}</div>
        <div onclick="deleteColumn(${ci})">âœ•</div>
      </div>
      <div class="card-container"></div>
    `;

    board.appendChild(column);
    const container=column.querySelector(".card-container");

    col.crops.forEach((crop,ri)=>{

      const sowVal=validateDate(crop.sow);
      const transVal=validateDate(crop.trans);

      let sowErr=sowVal.valid?"":sowVal.error;
      let transErr=transVal.valid?"":transVal.error;

let changeText="", changeClass="";


if(crop.lastChange){

  const now = new Date();
  const changeDate = new Date(
    crop.lastChange.year,
    crop.lastChange.month-1,
    crop.lastChange.day,
    crop.lastChange.hour||0
  );

  const diffDays = (now - changeDate) / (1000*60*60*24);

  if(changeDate > now){
    changeText = "ì–‘ì•¡ êµì²´ : ë‚ ì§œ ì˜¤ë¥˜";
    changeClass = "red";
  }else{

    const diff = diffDays.toFixed(1);
    changeText = `ì–‘ì•¡ êµì²´ : D+${diff}`;

    if(diffDays >= 14){
      changeClass = "red";
    }else if(diffDays >= 7){
      changeClass = "orange";
    }
  }
}




      const card=document.createElement("div");
      card.className="card";

      card.innerHTML=`
        <div class="label" contenteditable
          oninput="columns[${ci}].crops[${ri}].name=this.innerText">${crop.name}</div>

        <div class="date-section">

          ${crop.showSow!==false ? `
          <div class="date-block">
            <div class="small">íŒŒì¢…ì¼</div>
            <div class="big ${sowErr?'error':''}">
              ${sowErr?sowErr:formatDays(crop.sow)}
            </div>
            <div class="date-text">${sowErr?"":formatDate(crop.sow)}</div>
          </div>`:""}

          ${(crop.showSow!==false && crop.showTrans!==false)?'<div class="divider-vertical"></div>':""}

          ${crop.showTrans!==false ? `
          <div class="date-block">
            <div class="small">ì •ì‹ì¼</div>
            <div class="big ${transErr?'error':''}">
              ${transErr?transErr:formatDays(crop.trans)}
            </div>
            <div class="date-text">${transErr?"":formatDate(crop.trans)}</div>
          </div>`:""}

        </div>

        ${crop.showChange!==false ? `
<div class="change-info ${changeClass}">

          ${changeText}
          <button class="mark-btn" style="margin-left:auto"
            onclick="markChangeNow(${ci},${ri})">â†»</button>
        </div>`:""}

        ${crop.memo?`<div class="memo-divider"></div><div class="memo">${crop.memo}</div>`:""}

        <div class="card-menu">â˜°</div>
        <div class="card-options">
          <div onclick="openDateEditor(${ci},${ri})">ë‚ ì§œ ìˆ˜ì •</div>
          <div onclick="openMemoEditor(${ci},${ri})">ë©”ëª¨</div>
          <div onclick="openChangeEditor(${ci},${ri})">ì–‘ì•¡ êµì²´ ì£¼ê¸°</div>
          <div onclick="deleteCard(${ci},${ri})">ì‚­ì œ</div>
        </div>
      `;

      const menu=card.querySelector(".card-menu");
      const opt=card.querySelector(".card-options");

      menu.onclick=(e)=>{
        e.stopPropagation();
        document.querySelectorAll(".card-options").forEach(o=>o.style.display="none");
        opt.style.display="block";
      };

      container.appendChild(card);
    });

    new Sortable(container,{
      group:"shared",
      animation:150,
      onStart:()=>saveHistory(),
onEnd:(evt)=>{

  const fromColIndex = evt.from.closest(".column").dataset.index;
  const toColIndex   = evt.to.closest(".column").dataset.index;

  const movedItem = columns[fromColIndex].crops.splice(evt.oldIndex,1)[0];
  columns[toColIndex].crops.splice(evt.newIndex,0,movedItem);

  createUI();
}

    });

    const btn=document.createElement("button");
    btn.className="add-card-btn";
    btn.innerText="+";
    btn.onclick=()=>addCard(ci);
    column.appendChild(btn);
  });


}

// ===== CRUD =====
function addColumn(){
  saveHistory();
  columns.push({header:"ìƒˆ ì—´",crops:[]});
  createUI();
}

function deleteColumn(i){
  if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
    saveHistory();
    columns.splice(i,1);
    createUI();
  }
}

function addCard(i){
  saveHistory();
  const now=new Date();

  columns[i].crops.push({
    name:"ìƒˆ ì¹´ë“œ",
    sow:{year:now.getFullYear(),month:now.getMonth()+1,day:now.getDate()},
    trans:{year:now.getFullYear(),month:now.getMonth()+1,day:now.getDate()},
    lastChange:{year:now.getFullYear(),month:now.getMonth()+1,day:now.getDate()},
    memo:""
  });

  createUI();
}

function deleteCard(c,r){
  saveHistory();
  columns[c].crops.splice(r,1);
  createUI();
}

function markChangeNow(c,r){
  saveHistory();
  const now=new Date();
  columns[c].crops[r].lastChange={
    year:now.getFullYear(),
    month:now.getMonth()+1,
    day:now.getDate(),
    hour:now.getHours()   // âœ… ì‹œê°„ ì¶”ê°€
  };
  createUI();
}

// =============================
// ===== ì‘ì—… ë°°ë„ˆ ì‹œìŠ¤í…œ =====
// =============================

function createTaskUI(){

  const board=document.getElementById("taskBoard");
  board.innerHTML="";

  tasks.forEach((task,i)=>{
let diffDays=0;
let diffText="-";
let textStyle="";

if(task.start){
  const startDate=new Date(
    task.start.year,
    task.start.month-1,
    task.start.day,
    task.start.hour||0
  );

  const now=new Date();

  if(startDate>now){
    diffText="ë‚ ì§œ ì˜¤ë¥˜";
    textStyle="color:red;font-weight:bold;";
  }else{

    diffDays=(now-startDate)/(1000*60*60*24);
    diffText=`D+${diffDays.toFixed(1)}`;

    if(diffDays>=60){
      textStyle="color:red;font-weight:bold;text-decoration:underline;text-decoration-thickness:3px;";
    }else if(diffDays>=30){
      textStyle="color:orange;font-weight:bold;";
    }
  }
}

    const card=document.createElement("div");
    card.className="task-card";

    card.innerHTML=`
      <div contenteditable
        oninput="tasks[${i}].name=this.innerText"
        style="font-weight:bold;min-width:120px;">
        ${task.name}
      </div>

<div style="display:flex;align-items:center;gap:8px;">

<div style="font-size:18px;${textStyle}">
  ${diffText}
</div>


  <button class="mark-btn"
    onclick="markTaskNow(${i})">â†»</button>

</div>

<div style="opacity:0.4;">|</div>

<div style="flex:1;font-size:14px;">
  ${task.memo||""}
</div>


      <div class="card-menu">â˜°</div>
      <div class="card-options">
        <div onclick="openTaskDateEditor(${i})">ë‚ ì§œ ìˆ˜ì •</div>
        <div onclick="openTaskMemoEditor(${i})">ë©”ëª¨ ìˆ˜ì •</div>
        <div onclick="deleteTask(${i})">ì‚­ì œ</div>
      </div>
    `;

    const menu=card.querySelector(".card-menu");
    const opt=card.querySelector(".card-options");

    menu.onclick=(e)=>{
      e.stopPropagation();
      document.querySelectorAll(".card-options").forEach(o=>o.style.display="none");
      opt.style.display="block";
    };

    board.appendChild(card);
  });
// ì¬ë°°ê¸° í˜„í™©ê³¼ ë™ì¼í•œ ìŠ¤íƒ€ì¼ì˜ + ë²„íŠ¼
const btn=document.createElement("button");
btn.className="add-card-btn";
btn.innerText="+";
btn.onclick=addTask;

board.appendChild(btn);

new Sortable(board,{
  animation:150,
  onEnd:(evt)=>{
    const moved = tasks.splice(evt.oldIndex,1)[0];
    tasks.splice(evt.newIndex,0,moved);
    createTaskUI();
  }
});

}


function deleteTaskColumn(i){
  taskColumns.splice(i,1);
  createTaskUI();
}

function addTask(){
  const now=new Date();

  tasks.push({
    name:"ìƒˆ ì‘ì—…",
    start:{
      year:now.getFullYear(),
      month:now.getMonth()+1,
      day:now.getDate(),
      hour:now.getHours()
    },
    memo:""
  });

  createTaskUI();
}


function deleteTask(i){
  tasks.splice(i,1);
  createTaskUI();
}


function markTaskNow(i){
  const now=new Date();
  tasks[i].start={
    year:now.getFullYear(),
    month:now.getMonth()+1,
    day:now.getDate(),
    hour:now.getHours()
  };
  createTaskUI();
}


function openTaskDateEditor(i){
  const task=tasks[i];

  createModal(`
    <div class="modal-content">
      <div>ì‘ì—… ì‹œì‘ì¼</div>
      <div class="modal-fields">
        ${dateInputs("task",task.start)}
      </div>
      <div class="modal-buttons">
        <button class="cancel-btn" onclick="closeModal(this)">ì·¨ì†Œ</button>
        <button class="save-btn" onclick="saveTaskDate(${i},this)">ì €ì¥</button>
      </div>
    </div>
  `);
}

function saveTaskDate(i,btn){
  const m=btn.closest(".modal");

  tasks[i].start={
    year:+m.querySelector("#task-year").value,
    month:+m.querySelector("#task-month").value,
    day:+m.querySelector("#task-day").value,
    hour:+m.querySelector("#task-hour").value
  };

  m.remove();
  createTaskUI();
}

function openTaskMemoEditor(i){
  const task=tasks[i];

  createModal(`
    <div class="modal-content">
      <textarea id="taskMemo" style="height:100px">${task.memo||""}</textarea>
      <div class="modal-buttons">
        <button class="cancel-btn" onclick="closeModal(this)">ì·¨ì†Œ</button>
        <button class="save-btn" onclick="saveTaskMemo(${i},this)">ì €ì¥</button>
      </div>
    </div>
  `);
}

function saveTaskMemo(i,btn){
  tasks[i].memo=
    btn.closest(".modal").querySelector("#taskMemo").value;

  btn.closest(".modal").remove();
  createTaskUI();
}

// ===== ê¸°íƒ€ =====
document.addEventListener("click",(e)=>{
  if(!e.target.closest(".card"))
    document.querySelectorAll(".card-options").forEach(o=>o.style.display="none");
});

// ìƒë‹¨ ì œëª© ë¶ˆëŸ¬ì˜¤ê¸°
const savedTitle = localStorage.getItem("farmBoardTitle");
if(savedTitle){
  document.getElementById("farmTitle").innerText = savedTitle;
}
// ì‘ì—… ë°°ë„ˆ ì œëª© ë¶ˆëŸ¬ì˜¤ê¸°
const savedTaskTitle = localStorage.getItem("taskBoardTitle");
if(savedTaskTitle){
  document.getElementById("taskTitle").innerText = savedTaskTitle;
}
setInterval(updateClock,1000);
createUI();
createTaskUI();
updateClock();


</script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAnfstiWWezjQY4YJ3YJae8tsTGb3s9F-k",
    authDomain: "spinachslave.firebaseapp.com",
    projectId: "spinachslave",
    storageBucket: "spinachslave.firebasestorage.app",
    messagingSenderId: "974550491647",
    appId: "1:974550491647:web:f6359153646a7ffc9307ca",
    measurementId: "G-5VNY8MXJ4S"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  console.log("ğŸ”¥ Firebase ì—°ê²° ì™„ë£Œ");

  // ===== ê³µìš© saveData() =====
  window.saveData = async function() {
    // 1ï¸âƒ£ ë¡œì»¬Storage ì €ì¥
    localStorage.setItem("farmData", JSON.stringify(columns));
    localStorage.setItem("taskData", JSON.stringify(tasks));

    // 2ï¸âƒ£ Firestore ì €ì¥
    try {
      await setDoc(doc(db, "farmData", "board"), {
        columns: columns,
        tasks: tasks
      });
      alert("Firestore ì €ì¥ ì™„ë£Œ âœ…");
    } catch (e) {
      console.error("Firestore ì €ì¥ ì˜¤ë¥˜:", e);
      alert("Firestore ì €ì¥ ì‹¤íŒ¨ âŒ");
    }
  }
</script>


</body>
</html>



