<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Ïû¨Î∞∞ Î≥¥Îìú</title>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<style>
/* Í∏∞Ï°¥ CSS Í∑∏ÎåÄÎ°ú Ïú†ÏßÄ */
body{font-family:Arial;background:#f4f6f8;margin:0;padding:20px;}
#clock{font-size:18px;margin:0;}
.top-controls{display:flex;gap:10px;}
.top-controls button{padding:8px 14px;border:none;border-radius:8px;background:#6c8fc7;color:white;cursor:pointer;}
.board{display:flex;gap:20px;align-items:flex-start;}
.column{background:#e9eef5;padding:12px;border-radius:20px;width:300px;display:flex;flex-direction:column;}
.column-header{background:#6c8fc7;color:white;padding:10px;border-radius:16px;font-weight:bold;display:flex;justify-content:space-between;}
.card-container{margin-top:10px;display:flex;flex-direction:column;gap:12px;}
.card{background:white;padding:16px;border-radius:18px;box-shadow:0 2px 6px rgba(0,0,0,0.1);position:relative;}
.label{font-weight:bold;margin-bottom:10px;outline:none;}
.date-section{display:flex;justify-content:space-between;margin-top:6px;}
.date-block{width:48%;display:flex;flex-direction:column;}
.small{font-size:11px;color:#666;}
.big{font-size:18px;font-weight:bold;margin:2px 0;}
.date-text{font-size:13px;}
.divider-vertical{width:1px;background:rgba(0,0,0,0.15);}
.memo-divider{height:1px;background:rgba(0,0,0,0.2);margin:10px 0 6px 0;}
.memo{font-size:13px;}
.error{color:red;font-weight:bold;font-size:12px;margin-top:4px;}
.change-info{font-size:12px;margin-top:8px;color:#444;display:flex;align-items:center;gap:6px;}
.change-info.orange{color:orange;font-weight:bold;}
.change-info.red{color:red;font-weight:bold;text-decoration:underline;}
.card-menu{position:absolute;top:8px;right:10px;cursor:pointer;}
.card-options{display:none;position:absolute;top:26px;right:8px;background:white;border:1px solid #ccc;border-radius:8px;padding:6px;font-size:12px;z-index:1000;}
.card-options div{padding:6px 8px;cursor:pointer;}
.card-options div:hover{background:#f0f0f0;}
.add-card-btn{margin-top:10px;padding:10px 0;border:none;border-radius:16px;background:#d0d8e8;font-size:22px;cursor:pointer;}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.4);display:flex;justify-content:center;align-items:center;z-index:2000;}
.modal-content{background:white;padding:30px;border-radius:20px;width:600px;display:flex;flex-direction:column;gap:20px;}
.modal-fields{display:flex;gap:30px;justify-content:center;}
.modal-block{display:flex;flex-direction:column;gap:6px;align-items:center;}
.modal-block input{width:90px;padding:8px;border-radius:10px;border:1px solid #ccc;text-align:center;}
.modal-buttons{display:flex;justify-content:flex-end;gap:10px;}
.save-btn{background:#6c8fc7;color:white;padding:8px 16px;border:none;border-radius:10px;}
.cancel-btn{background:#ccc;padding:8px 16px;border:none;border-radius:10px;}
.mark-btn{background:#28a745;color:white;padding:4px 8px;border:none;border-radius:10px;font-size:11px;}
.task-card{background:white;padding:14px 20px;border-radius:18px;box-shadow:0 2px 6px rgba(0,0,0,0.1);display:flex;align-items:center;gap:20px;position:relative;}
.top-bar{display:flex;align-items:center;margin-bottom:20px;}
.top-controls{margin-left:auto;display:flex;gap:10px;}
</style>
</head>
<body>

<div class="top-bar">
  <h1 id="clock"></h1>
  <div class="top-controls">
    <button onclick="addColumn()">Ïó¥ Ï∂îÍ∞Ä</button>
    <button onclick="saveData()">Ï†ÄÏû•</button>
    <button onclick="undoAction()">Ïù¥Ï†Ñ ÌñâÎèô Î≥µÍµ¨</button>
  </div>
</div>
<hr style="margin:-5px 0;border:1px dashed #bbb">

<h2 id="farmTitle" contenteditable="true" oninput="localStorage.setItem('farmBoardTitle', this.innerText)">Ïû¨Î∞∞Í∏∞ ÌòÑÌô©</h2>
<div class="board" id="board"></div>
<hr style="margin:0px 0;border:1px dashed #bbb">

<h2 id="taskTitle" contenteditable="true" oninput="localStorage.setItem('taskBoardTitle', this.innerText)">ÏûëÏóÖ Î∞∞ÎÑà</h2>
<div id="taskBoard" style="display:flex;flex-direction:column;gap:12px;"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

// ===== Firebase ÏÑ§Ï†ï =====
const firebaseConfig = {
  apiKey: "AIzaSyAnfstiWWezjQY4YJ3YJae8tsTGb3s9F-k",
  authDomain: "spinachslave.firebaseapp.com",
  projectId: "spinachslave",
  storageBucket: "spinachslave.appspot.com",
  messagingSenderId: "974550491647",
  appId: "1:974550491647:web:f6359153646a7ffc9307ca",
  measurementId: "G-5VNY8MXJ4S"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
console.log("üî• Firebase Ïó∞Í≤∞ ÏôÑÎ£å");

// ===== Îç∞Ïù¥ÌÑ∞ =====
let columns = JSON.parse(localStorage.getItem("farmData")) || [];
let tasks = JSON.parse(localStorage.getItem("taskData")) || [];
let historyStack = [];

// ===== ÌûàÏä§ÌÜ†Î¶¨ =====
function saveHistory(){ historyStack.push(JSON.stringify(columns)); if(historyStack.length>50) historyStack.shift(); }
function undoAction(){ if(historyStack.length===0){ alert("ÎêòÎèåÎ¶¥ ÏûëÏóÖÏù¥ ÏóÜÏäµÎãàÎã§."); return; } columns = JSON.parse(historyStack.pop()); createUI(); }
document.addEventListener("keydown",(e)=>{ if(e.ctrlKey && e.key==="z"){ e.preventDefault(); undoAction(); } });

// ===== Firestore Ï†ÄÏû• =====
window.saveData = async function(){
  localStorage.setItem("farmData", JSON.stringify(columns));
  localStorage.setItem("taskData", JSON.stringify(tasks));
  try{
    await setDoc(doc(db, "farmData", "board"), { columns, tasks });
    alert("‚úÖ Firestore Ï†ÄÏû• ÏôÑÎ£å");
  }catch(e){
    console.error("Firestore Ï†ÄÏû• Ïò§Î•ò:", e);
    alert("‚ùå Firestore Ï†ÄÏû• Ïã§Ìå®");
  }
};
</script>

<script>
// ==========================
// Ïó¨Í∏∞Ïóê Í∏∞Ï°¥ createUI(), addColumn(), addCard(), deleteCard(), 
// openDateEditor(), saveDate(), openMemoEditor(), saveMemo(), 
// openChangeEditor(), saveChange(), createTaskUI(), addTask(), 
// markTaskNow(), openTaskDateEditor(), saveTaskDate(), 
// openTaskMemoEditor(), saveTaskMemo() Îì± Í∏∞Ï°¥ Ìï®Ïàò Í∑∏ÎåÄÎ°ú ÎÑ£Í∏∞
// ==========================
</script>

<script>
const savedTitle = localStorage.getItem("farmBoardTitle");
if(savedTitle) document.getElementById("farmTitle").innerText = savedTitle;
const savedTaskTitle = localStorage.getItem("taskBoardTitle");
if(savedTaskTitle) document.getElementById("taskTitle").innerText = savedTaskTitle;

function updateClock(){ document.getElementById("clock").innerText=new Date().toLocaleString(); }
setInterval(updateClock,1000);

createUI();
createTaskUI();
updateClock();
</script>

</body>
</html>
